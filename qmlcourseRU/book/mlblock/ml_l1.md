---
jupytext:
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
kernelspec:
  display_name: Python 3
  language: python
  name: python3
---

(mll1)=

# Машинное обучение как паззл

## Введение

Мы продолжаем вводную часть нашего курса и переходим к машинному обучению. Если тема для вас хорошо знакома, можете пропустить этот блок, при желании можно пройти  [этот тест](http://foo) для определения достаточности уровня знаний. Тест можно проигнорировать, если для вы не знакомы с машинным обучением и для вас выглядят магией такие вещи как автоматическая детекция лиц на фото или определение тональности отзыва на товар.   

Про машинное обучение, конечно, уже много всего написано, есть и немало неплохих курсов, сочетающих как теорию, так и практику. Но все же теория в этой области еще не догоняет практику, мы пока не понимаем, "почему оно работает", а гарантии обобщающей способности алгоритмов (т.е. гарантии того, что модель машинного обучения будет работать на новых данных) в теории даются только для очень простых моделей. Таким образом, работа со сложными моделями остается своего рода искусством с примесью математики, инженерных практик и просто следования хорошим практикам, выработанным, как правило, в корпорациях или академическом сообществе. 

В этой лекции мы примем сторону практика и расскажем про задачи машинного обучения как некоторый паззл (или лего, кому что ближе) – меняя разные кусочки, мы будем получать разные прикладные задачи/сценарии/модели применения машинного обучения. Для иллюстрации такое описание мы сопроводим 3**-мя примерами:

 - задача рекомендации контента и градиентный бустинг
 - Автоматическая оценка читаемости научной статьи и BERT
 - детекция COVID-19 на рентгенограммах и YOLO

В этой лекции мы не опишем подробно, что это за модели машинного обучения (градиентный бустинг, BERT, YOLO), но зато покажем, что сценарии их применения в разных задачах (анализ табличных данных, текстов, изображений) похожи. 


```{note}
В этой лекции мы почти не будем говорить о математике. И изложенный взгляд на машинное обучение как ремесло, вполне вероятно, вызовет критику со стороны специалистов в области статистики, эконометрики и теории машинного/статического обучения. Мы осознаем эти риски и тем не менее рассказываем о машинном обучении именно как о ремесле. Акцент в курс делается на квантовые вычисления и квантовое машинное обучение, и в этой лекции мы опишем задачи "классического" машинного обучения на том уровне, чтоб просто было понятно, как это переносится на квантово-классические вариационные схемы и прочие алгоритмы, о которых пойдет речь далее в курсе. 
```


## Составляющие части задачи машинного обучения

Выделим следующие компоненты ("паззлы"), которые просматриваются в разных задачах машинного обучения с учителем:

- Целевая переменная 
- Модель
- Данные
- Функция потерь 
- Оптимизатор
- Схема валидации 

По ходу изложения будем обсуждать упомянутые примеры задач машинного обучения. 

### Целевая переменная 

Есть задачи, в которых машинное обучение не нужно, а достаточно экспертных знаний. По закону Ома, известно что напряжение пропорционально силе тока и электрическому сопротивлению, и вряд ли захочется предсказывать напряжение в сети каким-то другим образом, кроме как применением закона Ома. То же самое можно сказать про многие другие физические явления. 

Однако, для очень многих явления вокруг нет хорошего теоретического объяснения или достаточных экспертных знаний. У нас нет "формулы", которая описала бы, как поставленный лайк к посту в соцсети, возврат кредита, клик по рекомендации товара или локализация заразы в конкретной части легких зависят от прочих факторов. В таких случаях мы можем приблизить такую неизвестную нам формулу с помощью машинного обучения. 


В идеале с помощью машинного обучения мы хотели бы предсказывать какое-то событие, явление или процесс так, чтоб от этого была польза: прибыль компании/клиентов, если речь о бизнес-проекте, или новые знания, если это исследовательский проект. При этом напрямую это сделать вряд ли получится, и надо определить целевую переменную, которая, как мы считаем, будет связана с целевым событем/явлением. Звучит абстрактно, и дать сторогое определение таких событий, явлений или процессов вряд ли получится. Поэтому сразу перейдем к примерам.

**Пример 1. Рекомендация новостного контента**

Новостному порталу хочется понять, какой контент нравится пользователям и по каким ссылкам они будут кликать. Здесь _событием_ будет то, что пользователю нравится рекомендуемый контент.  


```{figure} /_static/mlblock/see_also.png
:width: 600px
:name: see_also

Блок "Читайте также" на новостном портале
```

Понятно, что нет возможности установить строгую зависимость такого события от прочих факторов. Поэтому мы определяем целевую переменную: факт клика пользователя по показанной рекомендованной ссылке. Мы верим, что клик по ссылке связан с _событием_: если пользователю  нравится рекомендуемый контент, он/она перейдет по ссылке. 

**Пример 2. Автоматическая оценка читаемости научной статьи**

Допустим, научному журналу хочется автоматически оценивать читаемость текста, чтобы знать, какие статьи можно сразу подавать на ревью, а какие лучше предварительно направить в сервис proofreading, где статья будет вычитана и поправлена носителем языка. 

В идеале мы бы хотели предсказывать, "хорошо" ли написана статья или "плохо". Но это очень сложно определить формально, и потому есть много метрик читаемости текста, таких как [Automated readability index](https://en.wikipedia.org/wiki/Automated_readability_index) или [Flesch reading ease](https://en.wikipedia.org/wiki/Flesch%E2%80%93Kincaid_readability_tests#Flesch_reading_ease), которые являются эвристиками и "приближают" то что мы имеем в виду под хорошо или плохо написанным текстом. Кстати, на момент написания это лекции на платформе Kagglе проходит [соревнование](https://www.kaggle.com/c/commonlitreadabilityprize/overview) по этой теме. 

Описанную задачу можно решить и без всякого машинного обучения. Можно замерить 5-10 метрик читаемости текста, разметить 100-200 статей вручную (желательно, чтоб это делали эксперты уровня редактора журнала, а еще и лучше бы иметь по 3 оценки на статью) и заключить, хорошо ли метрики читаемости коррелируют с оценками экспертов. Но если этого окажется недостаточно, придется подумать. Пока остановимся тут и еще раз подчеркнем, что определить читаемость текста напрямую – невозможно, и мы это заменим на другую _Целевую переменную_, например, на агрегированную метрику читаемости текста. 

**Пример 3. Детекция COVID-19 на рентгенограммах**

### Данные

Определение _Целевой переменной_ неразрывно связано с имеющимися даными. Нет смысла определять целевую переменную, которую мы не можем измерить или по которой мы не можем собрать данные. Например, если новостной портал не логирует клики пользоватей, нет смысла задавать вопрос о том, нравятся ли пользователям показанные рекомендации – для начала надо настроить сервисы для хранения кликов. Другой пример: вряд ли стоит пытаться предсказывать движения денежных активов в микросекундном диапазоне, если нет дорогостоящей инфраструкруты для сбора и обработки таких данных. 

Но _Данные_ – это, конечно, не только целевая переменная. Но и _признаки_, также в эконометрике называемые предикторами или независимыми переменными. С помощью _признаков_ как раз и получится предсказать _Целевую переменную_, а хорошо или плохо – об этом чуть далее. 

Продумывание, сбор, и обработка  _признаков_ – один из наиболее творческих аспектов работы специалистов по машинному обучению. Эта работа может включать в себя общение с представителями предметной области или бизнеса, клиентами, чтение научных статей, применение и более технических приемов, таких как порождение признаков из других признаков (feature engineering) или использование моделей для получения признаков (например, признаки изображения, полученные предобученной искусственной нейросетью). 

**Пример 1. Рекомендация новостного контента**

**Пример 2. Автоматическая оценка читаемости научной статьи**

**Пример 3. Детекция COVID-19 на рентгенограммах**

### Модель

С моделированием знаком любой исследователь. Чтоб рассчитать минимальную толщину стекла вагона метро для защиты от птиц во время движения по открытым участкам, достаточно представить птицу цилиндром той же массы, и для данной задачи цилиндр будет подходящей моделью птицы. 

Подобным же образом, в задачах машинного обучения с учителем _Модель_ приближает _Целевую переменную_ и делает это с помощью _Данных_ и _Параметров_. (Параметры – это неотъемлемая часть модели, и поэтому мы их не выносим как отдельный компонент задач машинного обучения).

Надо понимать, что предлагая модель, мы совершаем уже второе упрощение. Сначала, как мы говорили, _Целевая переменная_ заменяет нам то, что мы реально хотим знать. А теперь, к тому же, мы заменяем целевую переменную на ее прогноз с помощью модели. 

**Пример 1. Рекомендация новостного контента**

**Пример 2. Автоматическая оценка читаемости научной статьи**

**Пример 3. Детекция COVID-19 на рентгенограммах**


### Функция потерь 

**Пример 1. Рекомендация новостного контента**

**Пример 2. Автоматическая оценка читаемости научной статьи**

**Пример 3. Детекция COVID-19 на рентгенограммах**

### Решатель

**Пример 1. Рекомендация новостного контента**

**Пример 2. Автоматическая оценка читаемости научной статьи**

**Пример 3. Детекция COVID-19 на рентгенограммах**

### Схема валидации 

**Пример 1. Рекомендация новостного контента**

**Пример 2. Автоматическая оценка читаемости научной статьи**

**Пример 3. Детекция COVID-19 на рентгенограммах**


